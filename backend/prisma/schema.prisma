generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Registration model - User registrations from landing page
model Registration {
  id       String  @id @default(uuid())
  fullName String  @map("full_name")
  phone    String // Encrypted phone number
  province String
  district String
  address  String?

  status RegistrationStatus @default(PENDING)
  source String             @default("landing_page")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([phone])
  @@index([status])
  @@index([createdAt])
  @@map("registration")
}

enum RegistrationStatus {
  PENDING
  CONTACTED
  SUCCESS
  REJECTED
}

// Page Sections - Dynamic Layout Engine
model Section {
  id         String     @id @default(uuid())
  key        String     @unique
  layoutType LayoutType @map("layout_type")
  content    Json
  images     String[]
  ctaLink    String?    @map("cta_link")
  sortOrder  Int        @default(0) @map("sort_order")
  isVisible  Boolean    @default(true) @map("is_visible")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([key])
  @@index([layoutType, sortOrder])
  @@map("section")
}

enum LayoutType {
  HERO_VIDEO
  HERO_IMAGE
  SPLIT_IMAGE_TEXT
  BENTO_GRID
  CAROUSEL
  MASONRY_GRID
  TEXT_ONLY
  CTA_BANNER
}

// Popup Banners
model BannerPopup {
  id           String  @id @default(uuid())
  imageUrl     String  @map("image_url")
  redirectUrl  String  @map("redirect_url")
  isActive     Boolean @default(true) @map("is_active")
  displayDelay Int     @default(3000) @map("display_delay")
  priority     Int     @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([isActive, priority])
  @@map("banner_popup")
}

// Campaign Events
model Event {
  id          String    @id @default(uuid())
  title       String
  description String?   @db.Text
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  coverImage  String    @map("cover_image")
  gallery     String[]
  content     Json?
  redirectUrl String?   @map("redirect_url") // URL to redirect when clicking "Xem chi tiết"
  isFeatured  Boolean   @default(false) @map("is_featured")
  isVisible   Boolean   @default(true) @map("is_visible")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([startDate])
  @@index([isFeatured, isVisible])
  @@map("event")
}

// Business Models (B2B)
model BusinessModel {
  id              String  @id @default(uuid())
  name            String
  description     String  @db.Text
  iconUrl         String? @map("icon_url")
  profitPotential String? @map("profit_potential")
  sortOrder       Int     @default(0) @map("sort_order")
  isVisible       Boolean @default(true) @map("is_visible")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([sortOrder])
  @@map("business_model")
}

// Partnership FAQs (B2B)
model PartnershipFaq {
  id        String  @id @default(uuid())
  question  String
  answer    String  @db.Text
  sortOrder Int     @default(0) @map("sort_order")
  isVisible Boolean @default(true) @map("is_visible")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([sortOrder])
  @@map("partnership_faq")
}

// Content Management model
model Content {
  id          String      @id @default(uuid())
  type        ContentType
  title       String
  description String?     @db.Text
  content     Json
  sortOrder   Int         @default(0) @map("sort_order")
  isVisible   Boolean     @default(true) @map("is_visible")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([type, sortOrder])
  @@map("content")
}

enum ContentType {
  HERO
  FEATURE
  STATISTIC
  FAQ
  PARTNER
  TESTIMONIAL
}

// Settings/Configuration model
model Configuration {
  id          String  @id @default(uuid())
  key         String  @unique
  value       Json
  description String?

  @@map("configuration")
}

// Admin User model
model AdminUser {
  id       String    @id @default(uuid())
  email    String    @unique
  password String
  fullName String    @map("full_name")
  role     AdminRole @default(ADMIN)
  isActive Boolean   @default(true) @map("is_active")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("admin_user")
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
}

// Click Tracking
model ClickTracking {
  id          String  @id @default(uuid())
  buttonName  String  @map("button_name")
  pageUrl     String? @map("page_url")
  redirectUrl String? @map("redirect_url") // URL đích mà button chuyển hướng tới
  userAgent   String? @map("user_agent")
  ipAddress   String? @map("ip_address")
  referrer    String?

  createdAt DateTime @default(now()) @map("created_at")

  @@index([buttonName])
  @@index([createdAt])
  @@map("click_tracking")
}

// Photo Gallery
model PhotoCategory {
  id        String  @id @default(uuid())
  name      String
  slug      String  @unique
  sortOrder Int     @default(0) @map("sort_order")
  isVisible Boolean @default(true) @map("is_visible")

  photos Photo[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([slug])
  @@index([sortOrder])
  @@map("photo_category")
}

model Photo {
  id          String  @id @default(uuid())
  title       String
  description String? @db.Text
  imageUrl    String  @map("image_url")
  categoryId  String  @map("category_id")
  sortOrder   Int     @default(0) @map("sort_order")
  isVisible   Boolean @default(true) @map("is_visible")

  category PhotoCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([categoryId])
  @@index([sortOrder])
  @@map("photo")
}
